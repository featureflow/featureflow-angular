/*!
 * Featureflow Client v1.3.6
 * Web: https://www.featureflow.io/
 * Date: 2019-12-16T13:23:28.927Z
 * Licence: Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Featureflow=t():e.Featureflow=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,n){"use strict";t.a={INIT:"INIT",LOADED:"LOADED",LOADED_FROM_CACHE:"LOADED_FROM_CACHE",ERROR:"ERROR",UPDATED_FEATURE:"UPDATED_FEATURE"}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){try{return JSON.parse(localStorage.getItem("ff:v130:"+t+":"+e)||"{}")}catch(e){return{}}}function o(e,t,n){return localStorage.setItem("ff:v130:"+t+":"+e,JSON.stringify(n))}var a=n(5),s=n(4),u=n(0),f=n(3),c=n(8),l=n.n(c),p=n(7),d=n.n(p),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y="https://app.featureflow.io",m="https://events.featureflow.io",g="https://rtm.featureflow.io",b={baseUrl:y,eventsUrl:m,rtmUrl:g,streaming:!0,defaultFeatures:{},useCookies:!0,offline:!1},w=new Error("init() has not been called with a valid apiKey"),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(r(this,e),this.receivedInitialResponse=!1,this.emitter=new l.a,this.apiKey=t,!this.apiKey)throw w;if(this.config=h({},b,s),a.a.setBaseUrl(this.config.baseUrl),a.a.setEventsUrl(this.config.eventsUrl),a.a.setApiKey(this.apiKey),this.updateUser(n),!this.config.offline&&this.config.streaming){new window.EventSource(this.config.rtmUrl+"/api/js/v1/stream/"+this.apiKey).onmessage=function(e){var t=[];try{t=JSON.parse(e.data)}catch(e){}a.a.getFeatures(i.config.baseUrl,i.apiKey,i.user,t,function(e,t){e?(i.emitter.emit(u.a.ERROR,e),f(e)):(i.features=h({},i.features,t),o(i.apiKey,i.user.id,i.features),i.emitter.emit(u.a.UPDATED_FEATURE,t),f(void 0,t))})}}this.on=this.emitter.on.bind(this.emitter),this.off=this.emitter.off.bind(this.emitter)}return v(e,[{key:"updateUser",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r={},s=h({},t.attributes,r);this.user={id:t.id||this.getAnonymousId(),attributes:s};var f=new Date,c=f.getHours(),l=new Array(1);l[0]=c,this.currentContext={attributes:{"featureflow.date":[].concat(f),"featureflow.hourofday":l}},this.features=i(this.apiKey,this.user.id),setTimeout(function(){e.emitter.emit(u.a.LOADED_FROM_CACHE,e.features),e.config.offline?setTimeout(function(){return e.features=e.config.defaultFeatures,o(e.apiKey,e.user.id,e.features),e.emitter.emit(u.a.INIT,e.features),e.emitter.emit(u.a.LOADED,e.features),n(void 0,e.features),e.user}):a.a.getFeatures(e.config.baseUrl,e.apiKey,e.user,[],function(t,r){return e.receivedInitialResponse=!0,t?(e.emitter.emit(u.a.ERROR,t),n(t)):(e.features=r||{},o(e.apiKey,e.user.id,e.features),e.emitter.emit(u.a.INIT,r),e.emitter.emit(u.a.LOADED,r),n(void 0,r)),e.user})},0)}},{key:"getFeatures",value:function(){return this.config.offline?this.evalAll(this.config.defaultFeatures):this.evalAll(this.features)}},{key:"getUser",value:function(){return this.user}},{key:"evaluate",value:function(e){if(this.config.offline){return new s.a(this.config.defaultFeatures[e]||"off")}var t=this.features[e];if(void 0===t)return new s.a("off");var n=this.evalRules(t),r=new s.a(n);return a.a.postEvaluateEvent(this.user,e,r.value()),r}},{key:"evalAll",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=this.evalRules(e[n]));return t}},{key:"evalRules",value:function(e){if("string"==typeof e)return e;for(var t in e.rules){var n=e.rules[t];if(this.ruleMatches(n))return n.variant}}},{key:"ruleMatches",value:function(e){if(!e.audience)return!0;for(var t in e.audience.conditions){var r=e.audience.conditions[t],i=!1,o=this.currentContext.attributes[r.target];for(var a in o){var s=o[a];if(n.i(f.a)(r.operator,s,r.values)){i=!0;break}}if(!i)return!1}return!0}},{key:"goal",value:function(e){if(!this.config.offline)return a.a.postGoalEvent(this.user,e,this.getFeatures(),function(){})}},{key:"getAnonymousId",value:function(){return localStorage.getItem("ff-anonymous-id")||this.resetAnonymousId()}},{key:"resetAnonymousId",value:function(){var e="anonymous:"+Math.random().toString(36).substring(2);return localStorage.setItem("ff-anonymous-id",e),this.config.useCookies&&d.a.set("ff-anonymous-id",e),e}},{key:"hasReceivedInitialResponse",value:function(){return this.receivedInitialResponse}}]),e}();t.a=A},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";function r(e){return"string"==typeof e?Date.parse(e):e instanceof Date?e.getTime():e}function i(e,t,n){return n=["in","notIn"].indexOf(e)>=0?n:n[0],(o[e]||a)(t,n)}t.a=i;var o={equals:function(e,t){return e===t},contains:function(e,t){return"string"==typeof e&&e.indexOf(t)>-1},startsWith:function(e,t){return"string"==typeof e&&e.startsWith(t)},endsWith:function(e,t){return"string"==typeof e&&e.endsWith(t)},matches:function(e,t){return"string"==typeof e&&"string"==typeof t&&new RegExp(t).test(e)},in:function(e,t){return"string"==typeof e&&Array.isArray(t)&&t.indexOf(e)>-1},notIn:function(e,t){return"string"==typeof e&&Array.isArray(t)&&t.indexOf(e)<0},before:function(e,t){return e=r(e),t=r(t),"number"==typeof e&&"number"==typeof t&&e<t},after:function(e,t){return e=r(e),t=r(t),"number"==typeof e&&"number"==typeof t&&e>t},greaterThan:function(e,t){return e>t},greaterThanOrEqual:function(e,t){return e>=t},lessThan:function(e,t){return e<t},lessThanOrEqual:function(e,t){return e<=t}},a=function(){return!1}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.storedValue=t.toLowerCase()}return i(e,[{key:"value",value:function(){return this.storedValue}},{key:"is",value:function(e){return e.toLowerCase()===this.value().toLowerCase()}},{key:"isOn",value:function(){return this.is("on")}},{key:"isOff",value:function(){return this.is("off")}}]),e}();t.a=o},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=new XMLHttpRequest;return r.addEventListener("load",function(){200===r.status&&"application/json;charset=UTF-8"===r.getResponseHeader("Content-Type")?n(null,JSON.parse(r.responseText)):n(r.statusText||"non 200 response status code")}),r.addEventListener("error",function(){n("error connecting with server")}),r.open(t.method,e),r.setRequestHeader("X-Featureflow-Client","JavascriptClient/"+u.a.version),t.body?(r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(t.body))):r.send(),r}function o(e){var t=unescape(encodeURIComponent(JSON.stringify(e)));return f.fromByteArray(a(t))}function a(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}var s=n(9),u=n.n(s),f=n(6),c=(n.n(f),this),l=void 0,p={events:[]},d=function(){var e=[];p.events.length>0&&(e.push.apply(e,r(p.events)),p.events=[],i(c.eventsUrl+"/api/js/v1/event/"+c.apiKey,{method:"POST",body:e})),l=null},h=function(){l||(l=setTimeout(d,4e3))};t.a={setBaseUrl:function(e){c.baseUrl=e},setEventsUrl:function(e){c.eventsUrl=e},setApiKey:function(e){c.apiKey=e},getFeatures:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments[4],s=r.length>0?"?keys="+r.join(","):"";i(e+"/api/js/v1/evaluate/"+t+"/user/"+encodeURI(o(n))+s,{method:"GET"},a)},postGoalEvent:function(e,t,n){return h(p.events.push({type:"goal",goalKey:t,impressions:1,evaluatedFeatures:n,timestamp:new Date,user:e}))},postEvaluateEvent:function(e,t,n){return h(p.events.push({type:"evaluate",featureKey:t,evaluatedVariant:n,impressions:1,user:e,timestamp:new Date}))}}},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function i(e){var t=r(e),n=t[0],i=t[1];return 3*(n+i)/4-i}function o(e,t,n){return 3*(t+n)/4-n}function a(e){var t,n,i=r(e),a=i[0],s=i[1],u=new p(o(e,a,s)),f=0,c=s>0?a-4:a;for(n=0;n<c;n+=4)t=l[e.charCodeAt(n)]<<18|l[e.charCodeAt(n+1)]<<12|l[e.charCodeAt(n+2)]<<6|l[e.charCodeAt(n+3)],u[f++]=t>>16&255,u[f++]=t>>8&255,u[f++]=255&t;return 2===s&&(t=l[e.charCodeAt(n)]<<2|l[e.charCodeAt(n+1)]>>4,u[f++]=255&t),1===s&&(t=l[e.charCodeAt(n)]<<10|l[e.charCodeAt(n+1)]<<4|l[e.charCodeAt(n+2)]>>2,u[f++]=t>>8&255,u[f++]=255&t),u}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function u(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(s(r));return i.join("")}function f(e){for(var t,n=e.length,r=n%3,i=[],o=16383,a=0,s=n-r;a<s;a+=o)i.push(u(e,a,a+o>s?s:a+o));return 1===r?(t=e[n-1],i.push(c[t>>2]+c[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(c[t>>10]+c[t>>4&63]+c[t<<2&63]+"=")),i.join("")}t.byteLength=i,t.toByteArray=a,t.fromByteArray=f;for(var c=[],l=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,v=d.length;h<v;++h)c[h]=d[h],l[d.charCodeAt(h)]=h;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t,n){var r,i;!function(o){var a=!1;if(r=o,void 0!==(i="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=i),a=!0,e.exports=o(),a=!0,!a){var s=window.Cookies,u=window.Cookies=o();u.noConflict=function(){return window.Cookies=s,u}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(n){function r(t,i,o){var a;if("undefined"!=typeof document){if(arguments.length>1){if(o=e({path:"/"},r.defaults,o),"number"==typeof o.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*o.expires),o.expires=s}o.expires=o.expires?o.expires.toUTCString():"";try{a=JSON.stringify(i),/^[\{\[]/.test(a)&&(i=a)}catch(e){}i=n.write?n.write(i,t):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var u="";for(var f in o)o[f]&&(u+="; "+f,!0!==o[f]&&(u+="="+o[f]));return document.cookie=t+"="+i+u}t||(a={});for(var c=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,p=0;p<c.length;p++){var d=c[p].split("="),h=d.slice(1).join("=");this.json||'"'!==h.charAt(0)||(h=h.slice(1,-1));try{var v=d[0].replace(l,decodeURIComponent);if(h=n.read?n.read(h,v):n(h,v)||h.replace(l,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(t===v){a=h;break}t||(a[v]=h)}catch(e){}}return a}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,n){r(t,"",e(n,{expires:-1}))},r.withConverter=t,r}return t(function(){})})},function(e,t){function n(){}n.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function r(){i.off(e,r),t.apply(n,arguments)}var i=this;return r._=t,this.on(e,r,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;for(r;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var o=0,a=r.length;o<a;o++)r[o].fn!==t&&r[o].fn._!==t&&i.push(r[o]);return i.length?n[e]=i:delete n[e],this}},e.exports=n},function(e,t){e.exports={name:"featureflow-client",version:"1.3.6",description:"Featureflow Javascript Client",author:"Featureflow <contact@featureflow.io>",license:"Apache-2.0",keywords:["featureflow","feature","analytics","client","feature flag","feature toggle","release"],files:["dist"],repository:{type:"git",url:"git+https://github.com/featureflow/featureflow-javascript-sdk.git"},main:"dist/featureflow.umd",scripts:{"build-bower":"rollup -c","build-lib":"webpack src/index.js dist/featureflow.umd.js","build-min":"webpack -p src/index.js dist/featureflow.umd.min.js",build:"node ./scripts/build.js",watch:"webpack --watch src/index.js dist/featureflow.umd.js",test:"karma start --single-run","test:watch":"karma start --auto-watch --reporters=dots",prepublish:"node ./scripts/build.js","publish:bower":"node ./scripts/bower.js",flow:"flow",example:"webpack-dev-server --config ./example/webpack.config.js --content-base example/ --inline --port 8182"},devDependencies:{babel:"^6.23.0","babel-core":"^6.25.0","babel-loader":"^6.4.1","babel-plugin-transform-flow-strip-types":"^6.22.0","babel-plugin-transform-object-rest-spread":"^6.23.0","babel-preset-es2015":"^6.24.1","base64-js":"1.3.1",chai:"3.5.0","css-loader":"^0.26.1","file-loader":"^0.10.0","flow-bin":"^0.39.0","gzip-size":"3.0.0","html-webpack-plugin":"^2.28.0","in-publish":"2.0.0",karma:"0.13.22","karma-chai":"0.1.0","karma-chrome-launcher":"1.0.1","karma-mocha":"1.0.1","karma-mocha-reporter":"2.0.4","karma-phantomjs-launcher":"0.2.1","karma-phantomjs-shim":"1.1.2","karma-sinon":"1.0.5","karma-sourcemap-loader":"0.3.7","karma-webpack":"2.0.2",mocha:"2.5.3",phantomjs:"^1.9.20","pretty-bytes":"3.0.1","readline-sync":"1.4.4",rollup:"^0.43.0","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.0","rollup-plugin-uglify":"^2.0.1","semver-compare":"^1.0.0",sinon:"1.17.4","style-loader":"^0.13.1",webpack:"2.2.1","webpack-dev-server":"^2.3.0"},dependencies:{"js-cookie":"^2.1.4","tiny-emitter":"^1.2.0"}}},function(e,t,n){"use strict";(function(e){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new i.a(e,t,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(0);t.init=r,n.d(t,"events",function(){return a});var a=o.a;t.default={init:r,events:a},void 0!==window.VERSION&&(e.exports.version=window.VERSION)}).call(t,n(2)(e))}])});